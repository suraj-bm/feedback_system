<!DOCTYPE html>
<html>
<head>
    <title>Voice Feedback</title>
    <link rel="stylesheet" href="../static/index.css">
</head>
<body>
    <h1>Java Session Feedback</h1>
    <button onclick="startFeedback()">ðŸŽ¤ Give Feedback</button>
    <p id="status"></p>

    <script>
        function startFeedback() {
            let utter= new SpeechSynthesisUtterance("How was todays java session?");
            speechSynthesis.speak(utter);
            utter.onend=function(){
                startListening();
            };
            

        }

        function startListening() {
            let recognition=new(window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang="en-IN";
            recognition.interimResults=false;
            recognition.maxAlternatives=1;
            document.getElementById("status").innerText="Listening...";
            recognition.start();
            recognition.onresult=function(event){
                let feedback=event.results[0][0].transcript;
                document.getElementById("status").innerText="You said: "+feedback;
                sendFeedback(feedback);
            };
            recognition.onerror=function(event){
                document.getElementById("status").innerText="Error occurred in recognition: "+event.error;
            };
        }

        function sendFeedback(feedback) {
            fetch("/save_feedback",{
                method:"POST",
                headers:{
                    "Content-Type":"application/json"
                },
                body:JSON.stringify({content:feedback})
            }).then(response=>response.json())
            .then(data=>{
                if(data.status==="success"){
                    document.getElementById("status").innerText="Feedback saved successfully!";
                } else {
                    document.getElementById("status").innerText="Failed to save feedback.";
                }
            }).catch(error=>{
                document.getElementById("status").innerText="Error: "+error;
            });
        }



    </script>
</body>
</html>
